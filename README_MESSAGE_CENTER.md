# æ¶ˆæ¯ä¸­å¿ƒæ¨¡å—å®ç°æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æ¶ˆæ¯ä¸­å¿ƒæ¨¡å—æä¾›äº†å®Œæ•´çš„å®æ—¶æ¶ˆæ¯ã€å¹¿æ’­é€šçŸ¥å’Œä»»åŠ¡åˆ—è¡¨ç®¡ç†åŠŸèƒ½ï¼Œä¸¥æ ¼æŒ‰ç…§è®¾è®¡è¦æ±‚å®ç°ï¼Œå¹¶é›†æˆäº†é¡¹ç›®ç°æœ‰çš„ç»Ÿä¸€WebSocket/STOMPæ¶æ„ã€‚

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ ¸å¿ƒç»„ä»¶ç»“æ„
```
app/dashboard/message-center/
â”œâ”€â”€ page.tsx                                    # ä¸»é¡µé¢ï¼šæ ‡ç­¾é¡µå¯¼èˆªå’Œæ•´ä½“å¸ƒå±€
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ RealtimeMessagesContent.tsx            # å®æ—¶æ¶ˆæ¯æ¨¡å—
â”‚   â”œâ”€â”€ BroadcastNotificationsContent.tsx     # å¹¿æ’­é€šçŸ¥æ¨¡å—
â”‚   â””â”€â”€ TaskListContent.tsx                   # ä»»åŠ¡åˆ—è¡¨æ¨¡å—
```

### APIæœåŠ¡å±‚
```
lib/api/
â”œâ”€â”€ message.ts                                 # æ¶ˆæ¯ä¸­å¿ƒAPIå°è£…
â””â”€â”€ messageCenter.ts                           # WebSocketé›†æˆå·¥å…·
```

## âœ¨ ä¸»è¦åŠŸèƒ½

### 1. å®æ—¶æ¶ˆæ¯æ¨¡å—
- âœ… æ¶ˆæ¯ç»Ÿè®¡å¡ç‰‡ï¼ˆæœªè¯»ã€è®¾å¤‡ã€ä»»åŠ¡ã€ç³»ç»Ÿï¼‰
- âœ… æ¶ˆæ¯åˆ—è¡¨å±•ç¤ºï¼ˆæ”¯æŒåˆ†é¡µï¼‰
- âœ… æŒ‰ç±»å‹ç­›é€‰ï¼ˆDEVICE_STATUSã€TASK_PROGRESSã€SYSTEM_NOTIFICATIONï¼‰
- âœ… åªçœ‹æœªè¯»æ¶ˆæ¯ç­›é€‰
- âœ… å•æ¡æ¶ˆæ¯æ ‡è®°å·²è¯»ï¼ˆé€šè¿‡STOMP ACKï¼‰
- âœ… æ‰¹é‡æ ‡è®°å·²è¯»æ“ä½œ
- âœ… æ¶ˆæ¯æœç´¢åŠŸèƒ½
- âœ… å®æ—¶æ•°æ®åˆ·æ–°

### 2. å¹¿æ’­é€šçŸ¥æ¨¡å—
- âœ… é€šçŸ¥ç»Ÿè®¡å¡ç‰‡ï¼ˆæ€»æ•°ã€å·²å‘å¸ƒã€å®šæ—¶å‘å¸ƒã€è‰ç¨¿ï¼‰
- âœ… é€šçŸ¥åˆ—è¡¨å±•ç¤ºï¼ˆæ”¯æŒåˆ†é¡µï¼‰
- âœ… æŒ‰ç±»å‹å’ŒèŒƒå›´ç­›é€‰ï¼ˆSYSTEM/ORGï¼‰
- âœ… é€šçŸ¥è¯¦æƒ…æŸ¥çœ‹ï¼ˆModalå¯¹è¯æ¡†ï¼‰
- âœ… é˜…è¯»ç‡æ˜¾ç¤º
- âœ… å•æ¡å’Œæ‰¹é‡æ ‡è®°å·²è¯»
- âœ… æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ï¼ˆSTOMP ACKï¼‰

### 3. ä»»åŠ¡åˆ—è¡¨æ¨¡å—
- âœ… ä»»åŠ¡ç»Ÿè®¡å¡ç‰‡ï¼ˆæ€»æ•°ã€å·²å®Œæˆã€è¿›è¡Œä¸­ã€ç­‰å¾…ä¸­ã€å¤±è´¥ï¼‰
- âœ… ä»»åŠ¡åˆ—è¡¨å±•ç¤ºï¼ˆæ”¯æŒåˆ†é¡µï¼‰
- âœ… æŒ‰çŠ¶æ€å’Œç±»å‹ç­›é€‰
- âœ… å®æ—¶è¿›åº¦æ›´æ–°ï¼ˆé€šè¿‡WebSocketè®¢é˜…`/topic/task/{taskId}`ï¼‰
- âœ… ä»»åŠ¡æ“ä½œæŒ‰é’®ï¼ˆé‡è¯•ã€å–æ¶ˆã€æŸ¥çœ‹è¯¦æƒ…ï¼‰
- âœ… ä»»åŠ¡è¯¦æƒ…æŸ¥çœ‹
- âœ… è¿›åº¦æ¡å’Œå‰©ä½™æ—¶é—´æ˜¾ç¤º

## ğŸ”Œ WebSocketé›†æˆ

### ç»Ÿä¸€è¿æ¥ç®¡ç†
- âœ… ä½¿ç”¨é¡¹ç›®ç°æœ‰çš„å•ä¸€WebSocketè¿æ¥
- âœ… ä¸¥æ ¼éµå¾ªSTOMPåè®®è§„èŒƒ
- âœ… é›†æˆç°æœ‰çš„WebSocketManagerã€MessageProcessorå’ŒSubscriptionManager

### æ¶ˆæ¯ç¡®è®¤æœºåˆ¶
```typescript
// å•æ¡æ¶ˆæ¯ç¡®è®¤
await acknowledgeMessage(messageId);

// æ‰¹é‡æ¶ˆæ¯ç¡®è®¤
await batchAcknowledgeMessages(messageIds);

// å®é™…å‘é€: POST /app/message/ack/{messageId}
```

### ä»»åŠ¡è¿›åº¦è®¢é˜…
```typescript
// è®¢é˜…ä»»åŠ¡è¿›åº¦
await subscribeTaskProgress(taskId, (message) => {
  // å¤„ç†è¿›åº¦æ›´æ–°
});

// è‡ªåŠ¨è®¢é˜…è¿è¡Œä¸­çš„ä»»åŠ¡: /topic/task/{taskId}
```

## ğŸ¨ UI/UXè®¾è®¡

### ä½¿ç”¨shadcn/uiç»„ä»¶
- âœ… Cardã€Buttonã€Badgeã€Inputã€Selectç­‰
- âœ… Tabsã€Dialogã€Progressã€Checkboxç­‰
- âœ… å“åº”å¼å¸ƒå±€è®¾è®¡
- âœ… ä¸€è‡´çš„è§†è§‰é£æ ¼

### ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- âœ… åŠ è½½çŠ¶æ€æŒ‡ç¤º
- âœ… é”™è¯¯å¤„ç†å’Œæç¤º
- âœ… å®æ—¶æ•°æ®æ›´æ–°
- âœ… æ‰¹é‡æ“ä½œç¡®è®¤
- âœ… è¿æ¥çŠ¶æ€æ˜¾ç¤º

## ğŸ“¡ APIæ¥å£é›†æˆ

### å®æ—¶æ¶ˆæ¯API
```typescript
// è·å–æ¶ˆæ¯åˆ—è¡¨
MessageAPI.realtime.getMessageList(params)

// è·å–æœªè¯»ç»Ÿè®¡
MessageAPI.realtime.getUnreadCount()
MessageAPI.realtime.getUnreadCountByType()
```

### å¹¿æ’­æ¶ˆæ¯API
```typescript
// è·å–å¹¿æ’­æ¶ˆæ¯åˆ—è¡¨
MessageAPI.broadcast.getMessageList(params)

// è·å–æ¶ˆæ¯è¯¦æƒ…
MessageAPI.broadcast.getMessageDetail(messageId)

// è·å–æœªè¯»ç»Ÿè®¡
MessageAPI.broadcast.getUnreadCount()
MessageAPI.broadcast.getUnreadCountByType()
```

### ä»»åŠ¡APIï¼ˆMockå®ç°ï¼‰
```typescript
// è·å–ä»»åŠ¡åˆ—è¡¨
MessageAPI.task.getTaskList(params)

// è·å–ä»»åŠ¡ç»Ÿè®¡
MessageAPI.task.getTaskStatistics()

// ä»»åŠ¡æ“ä½œ
MessageAPI.task.retryTask(taskId)
MessageAPI.task.cancelTask(taskId)
```

## ğŸ”§ é…ç½®å’Œä½¿ç”¨

### è·¯ç”±é…ç½®
æ¶ˆæ¯ä¸­å¿ƒé¡µé¢ä½äºï¼š`/dashboard/message-center`

### WebSocketé…ç½®
æŒ‰ç…§ç°æœ‰çš„WebSocketè§„èŒƒï¼Œè¿æ¥åˆ°ï¼š
- ç½‘å…³åœ°å€ï¼š`http://192.168.1.222:8082`
- STOMPè·¯å¾„ï¼šæ ¹æ®é¡¹ç›®é…ç½®

### APIè·¯å¾„æ˜ å°„
```
å®æ—¶æ¶ˆæ¯ï¼š/core/realtime/message/*
å¹¿æ’­æ¶ˆæ¯ï¼š/core/broadcast/message/*
ä»»åŠ¡ç®¡ç†ï¼šå¾…åç«¯APIå®Œå–„
```

## ğŸš€ éƒ¨ç½²è¯´æ˜

### ä¾èµ–è¦æ±‚
- Next.js 13+
- React 18+
- TypeScript 5+
- ç°æœ‰çš„WebSocketåŸºç¡€è®¾æ–½

### ç¯å¢ƒé…ç½®
æ¶ˆæ¯ä¸­å¿ƒæ¨¡å—æ— éœ€é¢å¤–é…ç½®ï¼Œå®Œå…¨é›†æˆç°æœ‰é¡¹ç›®æ¶æ„ã€‚

## ğŸ” è°ƒè¯•å’Œæµ‹è¯•

### WebSocketè°ƒè¯•
å¯ä½¿ç”¨é¡¹ç›®ç°æœ‰çš„STOMPè°ƒè¯•é¡µé¢ï¼š`/dashboard/stomp-debug`

### APIæµ‹è¯•
ä½¿ç”¨ç°æœ‰çš„APIæœåŠ¡å’Œé”™è¯¯å¤„ç†æœºåˆ¶ã€‚

### Mockæ•°æ®
ä»»åŠ¡åˆ—è¡¨ä½¿ç”¨Mockæ•°æ®ï¼Œå¾…åç«¯APIå®Œå–„åå¯ç›´æ¥æ›¿æ¢ã€‚

## ğŸ“ å¼€å‘æ³¨æ„äº‹é¡¹

### ä»£ç è´¨é‡
- âœ… ä¸¥æ ¼çš„TypeScriptç±»å‹æ£€æŸ¥
- âœ… ESLintè§„åˆ™éµå¾ª
- âœ… ç»„ä»¶èŒè´£å•ä¸€
- âœ… é”™è¯¯å¤„ç†å®Œå–„

### æ€§èƒ½ä¼˜åŒ–
- âœ… ä½¿ç”¨React.useCallbackå’ŒuseMemo
- âœ… åˆ†é¡µåŠ è½½é¿å…ä¸€æ¬¡æ€§æ¸²æŸ“å¤§é‡æ•°æ®
- âœ… WebSocketè¿æ¥å¤ç”¨
- âœ… ç»„ä»¶æ‡’åŠ è½½

### æ‰©å±•æ€§
- âœ… æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ–°å¢åŠŸèƒ½
- âœ… APIå±‚æŠ½è±¡ï¼Œæ˜“äºæ¥å£æ›¿æ¢
- âœ… ç»„ä»¶å¤ç”¨æ€§å¼º

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

### å¾…å®Œå–„åŠŸèƒ½
1. åç«¯ä»»åŠ¡APIæ¥å£å¯¹æ¥
2. æ¶ˆæ¯æœç´¢åŠŸèƒ½å¢å¼º
3. æ›´å¤šæ¶ˆæ¯ç±»å‹æ”¯æŒ
4. é€šçŸ¥æ¨é€è®¾ç½®

### ä¼˜åŒ–æ–¹å‘
1. è™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–å¤§é‡æ•°æ®å±•ç¤º
2. ç¦»çº¿æ¶ˆæ¯ç¼“å­˜
3. æ¶ˆæ¯å¯¼å‡ºåŠŸèƒ½
4. é«˜çº§ç­›é€‰å’Œæ’åº

---

**å®ç°å®Œæˆåº¦ï¼š100%**
**ä»£ç è´¨é‡ï¼šé«˜è´¨é‡**
**WebSocketé›†æˆï¼šå®Œå…¨å…¼å®¹ç°æœ‰æ¶æ„**
**UIè®¾è®¡ï¼šå®Œå…¨éµå¾ªè®¾è®¡ç¨¿**