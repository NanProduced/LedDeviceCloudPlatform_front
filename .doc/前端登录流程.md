ğŸ—ï¸ æ¶æ„ç†è§£

æˆ‘ä»¬çš„åç«¯ç³»ç»Ÿé‡‡ç”¨äº† Gatewayä»£ç†OAuth2 Client çš„æ¶æ„ï¼Œå‰ç«¯æ— éœ€å¤„ç†å¤æ‚çš„OAuth2æµç¨‹ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸ä¼˜é›…çš„è®¾è®¡ï¼š

- Gateway å……å½“OAuth2 Clientè§’è‰²
- Auth-Server å……å½“OAuth2 Authorization Serverè§’è‰²
- å‰ç«¯ åªéœ€è¦ç®€å•çš„é‡å®šå‘æœºåˆ¶

ğŸš€ å‰ç«¯ç™»å½•å®ç°æ–¹æ¡ˆ

æ–¹æ¡ˆä¸€ï¼šç›´æ¥é‡å®šå‘ï¼ˆæ¨èï¼‰

```
  // å‰ç«¯ç™»å½•å‡½æ•°
function login(redirectUri = window.location.origin + '/dashboard') {
// æ„å»ºOAuth2æˆæƒç«¯ç‚¹URLï¼ŒåŒ…å«å‰ç«¯æŒ‡å®šçš„å›è°ƒåœ°å€
const authUrl = /oauth2/authorization/gateway-server?redirect_uri=${encodeURIComponent(redirectUri)};
  // ç›´æ¥é‡å®šå‘åˆ°Gatewayçš„OAuth2ç«¯ç‚¹
  window.location.href = authUrl;
}

// ä½¿ç”¨ç¤ºä¾‹
document.getElementById('loginBtn').addEventListener('click', () => {
login('/dashboard'); // ç™»å½•æˆåŠŸåè·³è½¬åˆ°ä»ªè¡¨æ¿
});
```

ğŸ”„ å®Œæ•´çš„è®¤è¯æµç¨‹

sequenceDiagram
participant F as å‰ç«¯SPA
participant G as Gateway
participant A as Auth-Server
participant B as åç«¯æœåŠ¡

```
  F->>F: ç”¨æˆ·ç‚¹å‡»ç™»å½•
  F->>G: é‡å®šå‘åˆ° /oauth2/authorization/gateway-server?redirect_uri=/dashboard
  G->>G: SaveRequestServerOauth2AuthorizationRequestResolverä¿å­˜redirect_uriåˆ°session
  G->>A: é‡å®šå‘åˆ°Auth-Serverç™»å½•é¡µ
  A->>A: ç”¨æˆ·å¡«å†™è¡¨å•ç™»å½•
  A->>G: æˆæƒç å›è°ƒ
  G->>G: äº¤æ¢Access Tokenï¼Œå»ºç«‹ä¼šè¯
  G->>F: é‡å®šå‘åˆ° /dashboard (ä»sessionå–å‡ºçš„redirect_uri)
  F->>G: åç»­APIè¯·æ±‚ (è‡ªåŠ¨æºå¸¦Cookie)
  G->>B: è½¬å‘è¯·æ±‚ (æºå¸¦ç”¨æˆ·ä¿¡æ¯header)

```