🏗️ 架构理解

我们的后端系统采用了 Gateway代理OAuth2 Client 的架构，前端无需处理复杂的OAuth2流程，这是一个非常优雅的设计：

- Gateway 充当OAuth2 Client角色
- Auth-Server 充当OAuth2 Authorization Server角色
- 前端 只需要简单的重定向机制

🚀 前端登录实现方案

方案一：直接重定向（推荐）

```
  // 前端登录函数
function login(redirectUri = window.location.origin + '/dashboard') {
// 构建OAuth2授权端点URL，包含前端指定的回调地址
const authUrl = /oauth2/authorization/gateway-server?redirect_uri=${encodeURIComponent(redirectUri)};
  // 直接重定向到Gateway的OAuth2端点
  window.location.href = authUrl;
}

// 使用示例
document.getElementById('loginBtn').addEventListener('click', () => {
login('/dashboard'); // 登录成功后跳转到仪表板
});
```

🔄 完整的认证流程

sequenceDiagram
participant F as 前端SPA
participant G as Gateway
participant A as Auth-Server
participant B as 后端服务

```
  F->>F: 用户点击登录
  F->>G: 重定向到 /oauth2/authorization/gateway-server?redirect_uri=/dashboard
  G->>G: SaveRequestServerOauth2AuthorizationRequestResolver保存redirect_uri到session
  G->>A: 重定向到Auth-Server登录页
  A->>A: 用户填写表单登录
  A->>G: 授权码回调
  G->>G: 交换Access Token，建立会话
  G->>F: 重定向到 /dashboard (从session取出的redirect_uri)
  F->>G: 后续API请求 (自动携带Cookie)
  G->>B: 转发请求 (携带用户信息header)

```